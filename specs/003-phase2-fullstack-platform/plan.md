# Implementation Plan: Phase II Full-Stack Financial Platform

**Branch**: `003-phase2-fullstack-platform` | **Date**: 2026-01-25 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/003-phase2-fullstack-platform/spec.md`

## Summary

Build a modern full-stack web application exposing the Phase I financial core via APIs with a premium glassmorphic UI dashboard. The backend uses FastAPI + SQLModel with Neon PostgreSQL, while the frontend uses Next.js 14 with Tailwind CSS and Framer Motion. Authentication uses JWT tokens, and the architecture is designed for future AI agent integration.

## Technical Context

**Language/Version**: Python 3.11+ (backend), TypeScript 5.x (frontend)
**Primary Dependencies**: FastAPI, SQLModel, Next.js 14, Tailwind CSS, Framer Motion, Recharts, SWR
**Storage**: Neon PostgreSQL (serverless with connection pooling)
**Testing**: pytest + pytest-asyncio (backend), Jest + React Testing Library (frontend)
**Target Platform**: Modern web browsers (Chrome, Firefox, Safari, Edge - latest 2 versions)
**Project Type**: Web application (backend + frontend)
**Performance Goals**: LCP < 2s, API p95 < 200ms
**Constraints**: Single-user MVP, UI-only chatbot shell, no bank connections, demo mode required
**Scale/Scope**: ~30 API endpoints, ~10 screens, ~50 components

## Constitution Check

*GATE: Must pass before implementation. Re-check after Phase 1 design.*

### Phase II Laws Compliance

| Law | Status | Implementation |
|-----|--------|----------------|
| Spec-Driven Development | ✅ PASS | All functionality traced to spec.md and supplementary specs |
| Backend is Single Source of Truth | ✅ PASS | Frontend fetches all data from API |
| Backend-First Rule | ✅ PASS | API endpoints implemented before frontend components |
| No Hard-Coded UI Data | ✅ PASS | All displayed data from API calls |
| All Data from Neon DB | ✅ PASS | PostgreSQL is sole persistent store |
| JWT Authentication Required | ✅ PASS | JWT tokens for all authenticated endpoints |
| AI Expansion Mandatory | ✅ PASS | AI-ready APIs, event logging, machine-readable errors |
| Event-Driven Readiness | ✅ PASS | EventLog table, events_emitted in responses |

### Core Principles Compliance

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Driven Development | ✅ PASS | Full spec suite (spec.md, 00-overview, 02-database, 03-api, 12-uiux) |
| II. AI-First Architecture | ✅ PASS | AI context API, batch endpoints, chatbot shell |
| III. Cloud-Native Design | ✅ PASS | Stateless services, externalized config |
| IV. Multi-Modal Interface | ✅ PASS | Web dashboard, responsive design, i18n ready |
| V. Test-First Development | ✅ PASS | TDD workflow mandated |
| VI. Observability & Security | ✅ PASS | Structured logging, JWT auth, rate limiting |

## Project Structure

### Documentation (this feature)

```text
specs/003-phase2-fullstack-platform/
├── spec.md              # Main feature specification
├── 00-overview.md       # Product vision and goals
├── 02-database.md       # Data model specification
├── 03-api.md            # REST API specification
├── 12-uiux.md           # UI/UX design system
├── plan.md              # This implementation plan
├── research.md          # Technology research
├── data-model.md        # Entity definitions
├── quickstart.md        # Development setup guide
├── contracts/           # API contracts
│   └── openapi.yaml     # OpenAPI 3.1 specification
├── checklists/          # Quality checklists
│   └── supplementary-specs.md
└── tasks.md             # Implementation tasks (generated by /sp.tasks)
```

### Source Code (repository root)

```text
backend/
├── src/
│   ├── api/
│   │   ├── routes/
│   │   │   ├── auth.py           # Authentication endpoints
│   │   │   ├── transactions.py   # Transaction CRUD
│   │   │   ├── categories.py     # Category listing
│   │   │   ├── budgets.py        # Budget management
│   │   │   ├── dashboard.py      # Dashboard aggregation
│   │   │   ├── ai.py             # AI-ready endpoints
│   │   │   └── demo.py           # Demo mode endpoints
│   │   ├── dependencies.py       # FastAPI dependencies
│   │   └── middleware.py         # Rate limiting, CORS, security
│   ├── models/
│   │   ├── user.py               # User model
│   │   ├── wallet.py             # Wallet model
│   │   ├── transaction.py        # Transaction model
│   │   ├── category.py           # Category model
│   │   ├── budget.py             # Budget model
│   │   ├── goal.py               # Goal model
│   │   ├── event_log.py          # Event logging
│   │   └── schemas.py            # Pydantic response schemas
│   ├── services/
│   │   ├── auth_service.py       # JWT token management
│   │   ├── transaction_service.py
│   │   ├── budget_service.py
│   │   ├── dashboard_service.py
│   │   └── event_service.py      # Event emission
│   ├── repositories/
│   │   ├── base.py               # Base repository
│   │   ├── user_repository.py
│   │   ├── transaction_repository.py
│   │   ├── budget_repository.py
│   │   └── category_repository.py
│   ├── db/
│   │   ├── database.py           # Neon connection
│   │   ├── migrations/           # Alembic migrations
│   │   └── seed.py               # Demo data seeding
│   ├── core/
│   │   ├── config.py             # Settings management
│   │   ├── security.py           # Password hashing, JWT
│   │   └── exceptions.py         # Custom exceptions
│   └── main.py                   # FastAPI app entry
├── tests/
│   ├── unit/
│   ├── integration/
│   └── contract/
├── requirements.txt
├── requirements-dev.txt
├── alembic.ini
└── Dockerfile

frontend/
├── src/
│   ├── app/
│   │   ├── layout.tsx            # Root layout
│   │   ├── page.tsx              # Landing page
│   │   ├── (auth)/
│   │   │   ├── login/page.tsx
│   │   │   └── register/page.tsx
│   │   ├── dashboard/
│   │   │   ├── layout.tsx        # Dashboard layout with nav
│   │   │   ├── page.tsx          # Main dashboard
│   │   │   ├── transactions/page.tsx
│   │   │   ├── budgets/page.tsx
│   │   │   ├── analytics/page.tsx
│   │   │   └── settings/page.tsx
│   │   └── api/                  # API route handlers
│   ├── components/
│   │   ├── ui/                   # Base UI components
│   │   │   ├── Button.tsx
│   │   │   ├── Card.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Modal.tsx
│   │   │   └── ...
│   │   ├── dashboard/
│   │   │   ├── BalanceCard.tsx
│   │   │   ├── BudgetMeter.tsx
│   │   │   ├── RecentTransactions.tsx
│   │   │   └── InsightsCard.tsx
│   │   ├── transactions/
│   │   │   ├── TransactionList.tsx
│   │   │   ├── TransactionForm.tsx
│   │   │   └── TransactionFilters.tsx
│   │   ├── charts/
│   │   │   ├── SpendingPieChart.tsx
│   │   │   ├── TrendLineChart.tsx
│   │   │   └── BudgetRadialChart.tsx
│   │   ├── chatbot/
│   │   │   └── ChatbotShell.tsx
│   │   └── layout/
│   │       ├── Navbar.tsx
│   │       ├── Sidebar.tsx
│   │       └── Footer.tsx
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useTransactions.ts
│   │   ├── useBudgets.ts
│   │   └── useTheme.ts
│   ├── services/
│   │   ├── api.ts                # Axios/fetch client
│   │   ├── auth.ts
│   │   ├── transactions.ts
│   │   └── budgets.ts
│   ├── types/
│   │   ├── api.ts
│   │   ├── transaction.ts
│   │   ├── budget.ts
│   │   └── user.ts
│   ├── lib/
│   │   ├── utils.ts
│   │   └── formatters.ts
│   └── styles/
│       └── globals.css           # Tailwind + custom styles
├── public/
│   ├── icons/
│   └── images/
├── tests/
├── next.config.js
├── tailwind.config.js
├── tsconfig.json
└── package.json
```

**Structure Decision**: Web application with separate `backend/` and `frontend/` directories. Backend hosts FastAPI API, frontend hosts Next.js App Router application. Both communicate via REST API.

## Implementation Phases

### Phase 1: Database Schema (Backend First)

**Objective**: Establish Neon PostgreSQL database with all entities from 02-database.md

**Tasks**:
1. Set up Neon PostgreSQL project and connection pooling
2. Configure SQLModel with async support
3. Create Alembic migration infrastructure
4. Implement models: User, Wallet, Category, Transaction, Budget, Goal
5. Implement models: MonthlySnapshot, InsightCache, AgentMemory, EventLog
6. Create initial migration with all tables and indexes
7. Seed system categories with Urdu translations
8. Write unit tests for model validation

**Constitution Compliance**:
- All data in Neon PostgreSQL ✓
- UUID primary keys ✓
- Audit timestamps ✓
- Event-driven ready (EventLog) ✓

### Phase 2: Auth Bridge (JWT Authentication)

**Objective**: Implement JWT-based authentication per Security Laws

**Tasks**:
1. Implement password hashing with argon2
2. Create JWT token generation (access + refresh)
3. Implement auth endpoints: register, login, refresh, logout, me
4. Create auth middleware for protected routes
5. Configure httpOnly cookies for refresh tokens
6. Implement token refresh rotation
7. Add rate limiting to auth endpoints (5/minute)
8. Write contract tests for auth flow

**Constitution Compliance**:
- JWT tokens for all auth ✓
- No localStorage for tokens ✓
- httpOnly secure cookies ✓
- Rate limiting applied ✓

### Phase 3: Implement APIs

**Objective**: Build all REST endpoints from 03-api.md

**Tasks**:
1. Transaction CRUD endpoints with pagination
2. Category listing endpoint
3. Budget CRUD endpoints
4. Wallet CRUD endpoints
5. Goal CRUD endpoints
6. Batch transaction endpoint (AI optimization)
7. Input validation with Pydantic
8. Consistent error response schema
9. Event emission on all mutations
10. Write contract tests for all endpoints

**Constitution Compliance**:
- Backend is source of truth ✓
- Consistent JSON schema ✓
- Machine-readable error codes ✓
- Event-driven (events_emitted) ✓

### Phase 4: Dashboard Logic (Aggregation APIs)

**Objective**: Implement dashboard data aggregation endpoints

**Tasks**:
1. GET /dashboard/summary - financial overview
2. GET /dashboard/charts/spending-by-category - pie chart data
3. GET /dashboard/charts/spending-trend - line chart data
4. GET /dashboard/charts/budget-progress - radial chart data
5. Implement caching strategy for aggregations
6. Add period filtering (week, month, year, custom)
7. Month-over-month comparison calculations
8. Write integration tests for dashboard APIs

**Constitution Compliance**:
- All calculations server-side ✓
- Data from Neon DB ✓
- Cacheable responses ✓

### Phase 5: Connect Frontend

**Objective**: Build Next.js frontend consuming backend APIs

**Tasks**:
1. Set up Next.js 14 App Router project
2. Configure Tailwind CSS with design tokens from 12-uiux.md
3. Implement API client with SWR
4. Build auth pages (login, register)
5. Implement auth guard HOC
6. Build dashboard layout with sidebar navigation
7. Build dashboard page with summary cards
8. Build transactions page with CRUD forms
9. Build budgets page with meters
10. Build settings page with theme toggle
11. Implement loading and error states
12. Write component tests

**Constitution Compliance**:
- All data from API ✓
- No hardcoded data ✓
- Refetch after mutations ✓

### Phase 6: Add Charts

**Objective**: Implement interactive charts with Recharts

**Tasks**:
1. Spending by category pie chart
2. Income vs expenses trend line chart
3. Budget progress radial charts
4. Category comparison bar chart
5. Implement chart tooltips matching design system
6. Add empty states for no data
7. Implement lazy loading for chart components
8. Add chart animations (300ms duration)
9. Write visual regression tests

**Constitution Compliance**:
- Chart data from API ✓
- Glassmorphism tooltips ✓
- Accessible color contrast ✓

### Phase 7: Implement Demo Data

**Objective**: Create demo mode for hackathon presentations

**Tasks**:
1. Create seed_demo_data.py script
2. Generate 50 realistic transactions over 3 months
3. Create budgets with varied statuses (normal, warning, exceeded)
4. Create demo user account (demo@example.com)
5. Implement POST /api/v1/demo/reset endpoint
6. Add demo mode banner to UI
7. Add guided tour overlay (optional)
8. Test demo mode end-to-end

**Constitution Compliance**:
- Demo mode per hackathon constraints ✓
- One-click reset capability ✓
- Realistic sample data ✓

### Phase 8: Prepare AI Hooks

**Objective**: Implement AI-ready APIs and chatbot shell

**Tasks**:
1. GET /ai/context - user financial context
2. POST /ai/query - NLP query endpoint (stub)
3. POST /ai/insights/generate - insight trigger (stub)
4. Build ChatbotShell component
5. Implement expand/collapse animation
6. Add placeholder "AI coming soon" state
7. Prepare AgentMemory table for Phase III
8. Document AI integration points

**Constitution Compliance**:
- AI expansion mandatory ✓
- Machine-readable responses ✓
- Batch operations supported ✓
- Event schemas documented ✓

## Complexity Tracking

No complexity violations anticipated. Architecture follows constitution patterns.

| Concern | Resolution |
|---------|------------|
| Multiple projects | Justified: Standard web app pattern (backend + frontend) |
| JWT complexity | Required by constitution Security Laws |
| Event logging | Required for event-driven readiness |

## Risk Mitigation

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Neon cold starts | Medium | Medium | Connection pooling, keep-alive queries |
| JWT token theft | Low | High | httpOnly cookies, short expiry, refresh rotation |
| Chart performance | Low | Medium | Lazy loading, virtualization for large datasets |
| Mobile responsiveness | Medium | Medium | Mobile-first design, thorough device testing |

## Success Criteria

From spec.md and 00-overview.md:

| Metric | Target | Validation |
|--------|--------|------------|
| SC-001 | Add transaction < 30s | User testing |
| SC-002 | Dashboard LCP < 2s | Lighthouse |
| SC-003 | 100% data integrity | Persistence tests |
| SC-004 | CLI feature parity | Feature checklist |
| SC-005 | Mobile usable | Device testing |
| SC-006 | Chart accuracy | Data comparison |
| SC-007 | Budget warnings correct | Unit tests |
| SC-008 | Theme persistence | Session tests |
| SC-009 | Form validation | E2E tests |
| SC-010 | Glassmorphism rendering | Visual review |

## Next Steps

1. Run `/sp.tasks` to generate implementation task list
2. Begin Phase 1: Database Schema implementation
3. Follow TDD workflow (Red → Green → Refactor)
4. Create PHR after each significant milestone

## Related Artifacts

- [spec.md](./spec.md) - Main feature specification
- [00-overview.md](./00-overview.md) - Product vision
- [02-database.md](./02-database.md) - Data model specification
- [03-api.md](./03-api.md) - REST API specification
- [12-uiux.md](./12-uiux.md) - UI/UX design system
- [research.md](./research.md) - Technology research
- [data-model.md](./data-model.md) - Entity definitions
- [quickstart.md](./quickstart.md) - Development setup
- [contracts/openapi.yaml](./contracts/openapi.yaml) - OpenAPI specification
