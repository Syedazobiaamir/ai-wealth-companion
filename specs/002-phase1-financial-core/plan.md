# Implementation Plan: Phase I Financial Core

**Branch**: `002-phase1-financial-core` | **Date**: 2026-01-18 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-phase1-financial-core/spec.md`

## Summary

Build a fully functional CLI application for managing financial transactions and budgets. The core includes:
- Transaction CRUD with validation (income/expense types)
- Category management with emoji icons
- Budget tracking with overspend warnings
- In-memory storage using repository pattern
- Colored, emoji-rich CLI output using colorama and tabulate

## Technical Context

**Language/Version**: Python 3.10+
**Primary Dependencies**: colorama (colored text), tabulate (table display)
**Storage**: In-memory (dictionaries and lists)
**Testing**: pytest
**Target Platform**: Linux/macOS/Windows CLI
**Project Type**: Single project with layered architecture
**Performance Goals**: All operations < 1 second response time
**Constraints**: No database, no file persistence, CLI only
**Scale/Scope**: Single-user, session-based (data resets on restart)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Evidence |
|-----------|--------|----------|
| I. Spec-Driven Development | ✅ PASS | spec.md created before plan |
| II. AI-First Architecture | ✅ N/A | Phase I excludes AI features per constitution |
| III. Cloud-Native Design | ✅ N/A | Phase I is local CLI only per constitution |
| IV. Multi-Modal Interface | ✅ PASS | CLI with emoji + color per Phase I UI Guidelines |
| V. Test-First Development | ✅ PLANNED | TDD workflow in milestones |
| VI. Observability & Security | ✅ PARTIAL | Input validation required; no secrets |

### Phase I Laws Compliance

| Law | Status | Evidence |
|-----|--------|----------|
| All behavior from specifications | ✅ PASS | Spec defines all features |
| No AI features | ✅ PASS | Not included |
| No databases | ✅ PASS | In-memory only |
| CLI only interface | ✅ PASS | No web/API |
| Layer separation | ✅ PASS | models → services → repositories → cli |
| Framework-independent domain | ✅ PASS | Pure Python, no frameworks |
| Swappable storage | ✅ PASS | Repository pattern |
| Deterministic commands | ✅ PASS | Same input → same output |
| Testable commands | ✅ PASS | Service layer isolated |

## Project Structure

### Documentation (this feature)

```text
specs/002-phase1-financial-core/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Technology decisions
├── data-model.md        # Entity definitions
├── quickstart.md        # Usage guide
├── contracts/           # Service interfaces
│   └── service-interfaces.md
└── tasks.md             # Generated by /sp.tasks
```

### Source Code (repository root)

```text
src/
├── __init__.py
├── models/
│   ├── __init__.py
│   ├── transaction.py      # Transaction dataclass
│   ├── category.py         # Category dataclass
│   └── budget.py           # Budget dataclass + BudgetStatus
├── repositories/
│   ├── __init__.py
│   ├── base.py             # Abstract repository interfaces
│   ├── memory/
│   │   ├── __init__.py
│   │   ├── transaction_repository.py
│   │   ├── category_repository.py
│   │   └── budget_repository.py
├── services/
│   ├── __init__.py
│   ├── transaction_service.py
│   └── budget_service.py
└── cli/
    ├── __init__.py
    ├── main.py             # Entry point, main loop
    ├── menus.py            # Menu display functions
    └── formatters.py       # Table and color formatting

tests/
├── __init__.py
├── conftest.py             # Shared fixtures
├── unit/
│   ├── __init__.py
│   ├── test_models.py
│   ├── test_transaction_service.py
│   └── test_budget_service.py
└── integration/
    ├── __init__.py
    └── test_cli_flows.py
```

**Structure Decision**: Single project with layered architecture chosen because:
1. Phase I is CLI-only (no web/mobile)
2. Constitution requires layer separation (models, services, repositories, cli)
3. Simple structure appropriate for hackathon scope

## Milestones

### Milestone 1: Domain Models & Storage

**Goal**: Establish data structures and repository pattern foundation

**Deliverables**:
- Transaction, Category, Budget dataclasses
- Abstract repository interfaces
- In-memory repository implementations
- Unit tests for repositories

**Acceptance**: All repository CRUD operations pass tests

### Milestone 2: Transaction Engine

**Goal**: Implement transaction business logic

**Deliverables**:
- TransactionService with validation
- Add, update, delete, list operations
- Amount, date, type, category validation
- Unit tests for service layer

**Acceptance**: All transaction operations pass tests with validation

### Milestone 3: Budget System

**Goal**: Implement budget tracking and warnings

**Deliverables**:
- BudgetService with calculation logic
- Set budget, get status, overspend warnings
- Integration with transaction data
- Unit tests for budget calculations

**Acceptance**: Budget status accurately reflects transaction totals

### Milestone 4: CLI Interface

**Goal**: Build interactive command-line interface

**Deliverables**:
- Main menu loop
- Transaction management menus
- Budget management menus
- Category management menus
- Colored output with emojis
- Tabular transaction display

**Acceptance**: All menu flows work end-to-end

### Milestone 5: Search, Filter, Sorting

**Goal**: Add query capabilities

**Deliverables**:
- Filter by category
- Filter by date range
- Sort by amount (asc/desc)
- Search menu integration

**Acceptance**: All filter/sort operations return correct results

### Milestone 6: Demo Scenarios & Tests

**Goal**: Polish and demonstrate

**Deliverables**:
- Integration tests for full flows
- Demo script with sample data
- Error handling polish
- README updates

**Acceptance**: Demo can showcase all features in < 5 minutes

## Complexity Tracking

> No constitution violations requiring justification.

| Decision | Rationale |
|----------|-----------|
| Repository pattern | Required by constitution for swappable storage |
| Separate services layer | Required by constitution for testable commands |
| dataclasses for models | Simple, built-in, no extra dependencies |

## Dependencies

```
# requirements.txt
colorama>=0.4.6
tabulate>=0.9.0

# requirements-dev.txt
pytest>=7.0.0
pytest-cov>=4.0.0
```

## Risk Analysis

| Risk | Mitigation |
|------|------------|
| Windows color compatibility | colorama.init() handles Windows ANSI |
| Terminal width issues | Default to minimal columns, wrap long text |
| Date parsing errors | Strict YYYY-MM-DD validation with clear errors |

## Next Steps

1. Run `/sp.tasks` to generate implementation task list
2. Follow TDD: Write tests first per constitution
3. Implement milestones 1-6 in order
4. Commit after each milestone completion
